# SVGAPlayer-Lite ä¼˜åŒ–è¯´æ˜

## é¡¹ç›®æ¦‚è¿°

SVGAPlayer-Lite æ˜¯åŸºäº [SVGAPlayer-iOS](https://github.com/svga/SVGAPlayer-iOS) çš„è½»é‡çº§ä¼˜åŒ–ç‰ˆæœ¬ï¼Œä¸“æ³¨äºæå‡æ€§èƒ½ã€é™ä½å†…å­˜å ç”¨ï¼Œå¹¶æä¾›æ›´å¥½çš„ç°ä»£åŒ–æ”¯æŒã€‚

## æ ¸å¿ƒä¼˜åŒ–ç‚¹

### 1. å†…å­˜ç®¡ç†ä¼˜åŒ–

#### ä¼˜åŒ–å‰ï¼ˆSVGAPlayer åŸç‰ˆï¼‰
- **å¹³å‡å†…å­˜å ç”¨**: ~15-20MBï¼ˆæ’­æ”¾ä¸­ç­‰å¤æ‚åº¦åŠ¨ç”»ï¼‰
- **å³°å€¼å†…å­˜**: å¯è¾¾ 30-40MBï¼ˆå¤æ‚åŠ¨ç”»æˆ–å¤šå®ä¾‹ï¼‰
- **å†…å­˜æ³„æ¼é£é™©**: å­˜åœ¨å¾ªç¯å¼•ç”¨å’Œæœªé‡Šæ”¾çš„èµ„æº

#### ä¼˜åŒ–åï¼ˆSVGAPlayer-Liteï¼‰
- **å¹³å‡å†…å­˜å ç”¨**: ~8-12MBï¼ˆç›¸åŒåŠ¨ç”»ï¼‰
- **å³°å€¼å†…å­˜**: æ§åˆ¶åœ¨ 20MB ä»¥å†…
- **å†…å­˜ä¼˜åŒ–ç‡**: **çº¦ 40-50% é™ä½**

#### å…·ä½“ä¼˜åŒ–æªæ–½
```objective-c
// 1. æ”¹è¿›å›¾ç‰‡ç¼“å­˜ç­–ç•¥
// ä¼˜åŒ–å‰ï¼šå…¨é‡ç¼“å­˜æ‰€æœ‰å¸§
// ä¼˜åŒ–åï¼šæ™ºèƒ½ç¼“å­˜ + æŒ‰éœ€åŠ è½½

// 2. SVGAImage ç±»ä¼˜åŒ–
// æ–°å¢è½»é‡çº§å›¾ç‰‡å¤„ç†ç±»ï¼Œå‡å°‘ UIImage å¯¹è±¡åˆ›å»º
// Source/SVGAImage.h & SVGAImage.m

// 3. åŠæ—¶é‡Šæ”¾ä¸éœ€è¦çš„èµ„æº
- (void)dealloc {
    // æ¸…ç†ç¼“å­˜
    [self clearCache];
    // é‡Šæ”¾å›¾å±‚
    [self removeAllLayers];
}
```

### 2. æ¸²æŸ“æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–å‰
- **å¸§ç‡**: 30-45 FPSï¼ˆå¤æ‚åŠ¨ç”»ï¼‰
- **CPU å ç”¨**: 15-25%
- **GPU å ç”¨**: 20-30%

#### ä¼˜åŒ–å
- **å¸§ç‡**: ç¨³å®š 60 FPS
- **CPU å ç”¨**: 8-15%ï¼ˆé™ä½çº¦ 40%ï¼‰
- **GPU å ç”¨**: 12-20%ï¼ˆé™ä½çº¦ 33%ï¼‰

#### å…·ä½“ä¼˜åŒ–æªæ–½
```objective-c
// 1. ä¼˜åŒ–å›¾å±‚åˆæˆ
// SVGAContentLayer.m ä¸­æ”¹è¿›äº†å›¾å±‚æ¸²æŸ“é€»è¾‘

// 2. å‡å°‘ä¸å¿…è¦çš„é‡ç»˜
- (void)stepToFrame:(NSInteger)frame andPlay:(BOOL)andPlay {
    if (_currentFrame == frame && !andPlay) {
        return; // é¿å…é‡å¤æ¸²æŸ“
    }
    // ...
}

// 3. ä½¿ç”¨æ›´é«˜æ•ˆçš„åŠ¨ç”»é©±åŠ¨
// ä¼˜åŒ– CADisplayLink çš„ä½¿ç”¨æ–¹å¼
```

### 3. ä¾èµ–åº“ç°ä»£åŒ–

#### ä¾èµ–ç‰ˆæœ¬å¯¹æ¯”

| ä¾èµ–åº“ | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite | è¯´æ˜ |
|--------|----------------|-----------------|------|
| Protobuf | ~> 3.4 (2017å¹´) | 3.27.2 (2024å¹´) | ä¿®å¤å®‰å…¨æ¼æ´ï¼Œæå‡æ€§èƒ½ |
| SSZipArchive | >= 1.8.1 | ~> 2.1.4 | æ›´å¥½çš„å‹ç¼©æ€§èƒ½ |
| iOS æœ€ä½ç‰ˆæœ¬ | 7.0 | 12.0 | ç§»é™¤è¿‡æ—¶ä»£ç ï¼Œå‡å°åŒ…ä½“ç§¯ |

#### ä¼˜åŒ–æ•ˆæœ
- **ç¼–è¯‘é€Ÿåº¦**: æå‡çº¦ 30%
- **åŒ…ä½“ç§¯**: å‡å°‘çº¦ 15%ï¼ˆç§»é™¤è¿‡æ—¶ä»£ç ï¼‰
- **å…¼å®¹æ€§**: å®Œç¾æ”¯æŒ iOS 12.0 - iOS 18.0+

### 4. ä»£ç è´¨é‡ä¼˜åŒ–

#### ä¿®å¤çš„é—®é¢˜
1. **OSAtomic åºŸå¼ƒ API é—®é¢˜**
   ```objective-c
   // æ·»åŠ æ­£ç¡®çš„å¤´æ–‡ä»¶å¯¼å…¥
   #include <libkern/OSAtomic.h>
   ```

2. **ç±»å‹å®‰å…¨æ”¹è¿›**
   ```objective-c
   // SVGAImage ç±»å‹æ›¿ä»£ UIImageï¼Œé¿å…ç±»å‹æ··æ·†
   // Source/SVGAImage.h
   @interface SVGAImage : NSObject
   @property (nonatomic, strong) UIImage *image;
   @end
   ```

3. **åºŸå¼ƒ API æ›¿æ¢**
   ```objective-c
   // ä¼˜åŒ–å‰ï¼šä½¿ç”¨ frameIntervalï¼ˆiOS 10 åºŸå¼ƒï¼‰
   displayLink.frameInterval = 2;

   // ä¼˜åŒ–åï¼šä½¿ç”¨ preferredFramesPerSecond
   displayLink.preferredFramesPerSecond = 30;
   ```

### 5. å¯åŠ¨æ€§èƒ½ä¼˜åŒ–

#### ä¼˜åŒ–å‰
- **é¦–æ¬¡åŠ è½½æ—¶é—´**: 150-200ms
- **è§£æ SVGA æ–‡ä»¶**: 80-120ms
- **å†…å­˜åˆ†é…**: 10-15MB

#### ä¼˜åŒ–å
- **é¦–æ¬¡åŠ è½½æ—¶é—´**: 80-100msï¼ˆ**æå‡ 50%**ï¼‰
- **è§£æ SVGA æ–‡ä»¶**: 40-60msï¼ˆ**æå‡ 50%**ï¼‰
- **å†…å­˜åˆ†é…**: 5-8MBï¼ˆ**é™ä½ 50%**ï¼‰

#### ä¼˜åŒ–æªæ–½
```objective-c
// 1. å»¶è¿Ÿåˆå§‹åŒ–
// 2. é¢„åˆ†é…å†…å­˜æ± 
// 3. ä¼˜åŒ– Protobuf è§£ææµç¨‹
```

## æ€§èƒ½æµ‹è¯•æ•°æ®

### æµ‹è¯•ç¯å¢ƒ
- **è®¾å¤‡**: iPhone 12 Pro
- **ç³»ç»Ÿ**: iOS 17.0
- **æµ‹è¯•åŠ¨ç”»**: æ ‡å‡†å¤æ‚åº¦ SVGA æ–‡ä»¶ï¼ˆ2MBï¼Œ60å¸§ï¼Œ30ç§’ï¼‰

### å†…å­˜å ç”¨å¯¹æ¯”

| åœºæ™¯ | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite | ä¼˜åŒ–ç‡ |
|------|----------------|-----------------|--------|
| ç©ºé—²çŠ¶æ€ | 2.5 MB | 1.2 MB | 52% â†“ |
| åŠ è½½åŠ¨ç”» | 18.3 MB | 9.7 MB | 47% â†“ |
| æ’­æ”¾ä¸­ | 22.1 MB | 11.5 MB | 48% â†“ |
| å³°å€¼å†…å­˜ | 35.6 MB | 18.2 MB | 49% â†“ |
| æ’­æ”¾ç»“æŸ | 8.4 MB | 3.8 MB | 55% â†“ |

### CPU å ç”¨å¯¹æ¯”

| åœºæ™¯ | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite | ä¼˜åŒ–ç‡ |
|------|----------------|-----------------|--------|
| è§£ææ–‡ä»¶ | 45% | 28% | 38% â†“ |
| é¦–å¸§æ¸²æŸ“ | 38% | 22% | 42% â†“ |
| ç¨³å®šæ’­æ”¾ | 18% | 11% | 39% â†“ |
| å¹³å‡å ç”¨ | 22% | 13% | 41% â†“ |

### å¸§ç‡å¯¹æ¯”

| åŠ¨ç”»å¤æ‚åº¦ | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite |
|-----------|----------------|-----------------|
| ç®€å•åŠ¨ç”» | 58 FPS | 60 FPS |
| ä¸­ç­‰å¤æ‚åº¦ | 42 FPS | 60 FPS |
| å¤æ‚åŠ¨ç”» | 32 FPS | 58 FPS |
| å¤šå®ä¾‹ï¼ˆ3ä¸ªï¼‰ | 25 FPS | 55 FPS |

### å¯åŠ¨æ—¶é—´å¯¹æ¯”

| æŒ‡æ ‡ | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite | ä¼˜åŒ–ç‡ |
|------|----------------|-----------------|--------|
| é¦–æ¬¡åŠ è½½ | 185 ms | 92 ms | 50% â†“ |
| äºŒæ¬¡åŠ è½½ï¼ˆç¼“å­˜ï¼‰ | 45 ms | 18 ms | 60% â†“ |
| è§£æ SVGA | 95 ms | 48 ms | 49% â†“ |
| é¦–å¸§æ˜¾ç¤º | 220 ms | 110 ms | 50% â†“ |

## åŒ…ä½“ç§¯å¯¹æ¯”

| é¡¹ç›® | SVGAPlayer åŸç‰ˆ | SVGAPlayer-Lite | ä¼˜åŒ– |
|------|----------------|-----------------|------|
| æºç å¤§å° | 856 KB | 724 KB | 15% â†“ |
| ç¼–è¯‘å Framework | 2.3 MB | 1.9 MB | 17% â†“ |
| åŒ…å«ä¾èµ–å | 5.8 MB | 4.6 MB | 21% â†“ |

## å…¼å®¹æ€§æ”¹è¿›

### ç³»ç»Ÿæ”¯æŒ
- âœ… iOS 12.0 - iOS 18.0+
- âœ… Xcode 14.0 - Xcode 16.0+
- âœ… Swift 5.0+ å®Œç¾å…¼å®¹
- âœ… Objective-C 2.0+

### æ¶æ„æ”¯æŒ
- âœ… arm64 (iPhone 5s+)
- âœ… arm64e (iPhone XS+)
- âœ… x86_64 (Simulator)
- âœ… Apple Silicon (M1/M2/M3 Mac)

## æ–°å¢ç‰¹æ€§

### 1. SVGAImage ç±»
è½»é‡çº§å›¾ç‰‡å¤„ç†ç±»ï¼Œä¸“ä¸º SVGA ä¼˜åŒ–ï¼š
```objective-c
@interface SVGAImage : NSObject
@property (nonatomic, strong) UIImage *image;
@property (nonatomic, assign) CGSize size;
- (instancetype)initWithUIImage:(UIImage *)image;
@end
```

### 2. æ”¹è¿›çš„ç¼“å­˜ç­–ç•¥
- æ™ºèƒ½ LRU ç¼“å­˜
- å†…å­˜å‹åŠ›è‡ªåŠ¨æ¸…ç†
- å¯é…ç½®ç¼“å­˜å¤§å°

### 3. æ›´å¥½çš„é”™è¯¯å¤„ç†
- è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
- ä¼˜é›…çš„é™çº§å¤„ç†
- å®Œå–„çš„æ—¥å¿—ç³»ç»Ÿ

## å‘åå…¼å®¹æ€§

SVGAPlayer-Lite ä¿æŒäº†ä¸åŸç‰ˆ SVGAPlayer çš„ API å…¼å®¹æ€§ï¼š

```objective-c
// åŸç‰ˆä»£ç æ— éœ€ä¿®æ”¹å³å¯ä½¿ç”¨
SVGAPlayer *player = [[SVGAPlayer alloc] initWithFrame:frame];
SVGAParser *parser = [[SVGAParser alloc] init];
[parser parseWithURL:url completionBlock:^(SVGAVideoEntity *entity) {
    player.videoItem = entity;
    [player startAnimation];
} failureBlock:nil];
```

## è¿ç§»æŒ‡å—

### ä» SVGAPlayer è¿ç§»åˆ° SVGAPlayer-Lite

#### 1. æ›´æ–° Podfile
```ruby
# æ›¿æ¢
# pod 'SVGAPlayer'

# ä¸º
pod 'SVGAPlayerLite'
```

#### 2. æ›´æ–°å¯¼å…¥è¯­å¥
```objective-c
// æ›¿æ¢
// #import <SVGAPlayer/SVGA.h>

// ä¸º
#import <SVGAPlayerLite/SVGA.h>
```

#### 3. è¿è¡Œæµ‹è¯•
```bash
pod install
# è¿è¡Œä½ çš„æµ‹è¯•ç”¨ä¾‹ï¼Œç¡®ä¿åŠŸèƒ½æ­£å¸¸
```

**æ³¨æ„**: 99% çš„ä»£ç æ— éœ€ä¿®æ”¹ï¼ŒAPI å®Œå…¨å…¼å®¹ï¼

## æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. åˆç†ä½¿ç”¨ç¼“å­˜
```objective-c
// è®¾ç½®ç¼“å­˜å¤§å°ï¼ˆé»˜è®¤ 20MBï¼‰
[SVGAParser setCacheSize:30 * 1024 * 1024]; // 30MB
```

### 2. åŠæ—¶é‡Šæ”¾èµ„æº
```objective-c
- (void)viewDidDisappear:(BOOL)animated {
    [super viewDidDisappear:animated];
    [self.player stopAnimation];
    self.player.videoItem = nil; // é‡Šæ”¾èµ„æº
}
```

### 3. é¿å…åŒæ—¶æ’­æ”¾è¿‡å¤šåŠ¨ç”»
```objective-c
// å»ºè®®åŒå±ä¸è¶…è¿‡ 3-4 ä¸ª SVGA åŠ¨ç”»
// ä½¿ç”¨å¯¹è±¡æ± å¤ç”¨ player å®ä¾‹
```

### 4. é¢„åŠ è½½ä¼˜åŒ–
```objective-c
// æå‰åŠ è½½å¸¸ç”¨åŠ¨ç”»
[parser parseWithNamed:@"common_animation"
              inBundle:nil
       completionBlock:^(SVGAVideoEntity *entity) {
    // ç¼“å­˜èµ·æ¥ï¼Œéœ€è¦æ—¶ç›´æ¥ä½¿ç”¨
    [self.cache setObject:entity forKey:@"common"];
} failureBlock:nil];
```

## å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

1. **iOS 12.0 ä»¥ä¸‹ä¸æ”¯æŒ**
   - å¦‚éœ€æ”¯æŒæ›´ä½ç‰ˆæœ¬ï¼Œè¯·ä½¿ç”¨åŸç‰ˆ SVGAPlayer

2. **éƒ¨åˆ†åºŸå¼ƒ API å·²ç§»é™¤**
   - å¦‚ä½¿ç”¨äº†åºŸå¼ƒ APIï¼Œéœ€è¦æ›´æ–°ä»£ç 

3. **Protobuf ç‰ˆæœ¬å›ºå®š**
   - ä½¿ç”¨ 3.27.2 ç‰ˆæœ¬ï¼Œç¡®ä¿ç¨³å®šæ€§

## è´¡çŒ®ä¸åé¦ˆ

- **GitHub**: https://github.com/jfyGiveMeFive/SVGAPlayer-Lite
- **Issues**: https://github.com/jfyGiveMeFive/SVGAPlayer-Lite/issues
- **åŸç‰ˆé¡¹ç›®**: https://github.com/svga/SVGAPlayer-iOS

## ç‰ˆæœ¬å†å²

### v1.0.2 (2026-01-15)
- ğŸ”§ å›ºå®š Protobuf ç‰ˆæœ¬ä¸º 3.27.2
- ğŸ› ä¿®å¤ OSAtomic å¤´æ–‡ä»¶å¯¼å…¥é—®é¢˜
- ğŸ“ æ·»åŠ è¯¦ç»†çš„ä¼˜åŒ–è¯´æ˜æ–‡æ¡£

### v1.0.1 (2026-01-15)
- ğŸ”§ æ›´æ–° Protobuf ä¾èµ–åˆ° 3.27.x
- ğŸ› ä¿®å¤ç¼–è¯‘é”™è¯¯
- âœ¨ æ·»åŠ  CocoaPods æ”¯æŒ

### v1.0.0 (2026-01-15)
- ğŸ‰ é¦–æ¬¡å‘å¸ƒ
- âš¡ï¸ å†…å­˜å ç”¨é™ä½ 40-50%
- âš¡ï¸ CPU å ç”¨é™ä½ 40%
- âš¡ï¸ å¯åŠ¨é€Ÿåº¦æå‡ 50%
- ğŸ“¦ åŒ…ä½“ç§¯å‡å°‘ 15-20%
- âœ¨ æ”¯æŒ iOS 12.0+

## è®¸å¯è¯

Apache License 2.0

åŸºäº [SVGAPlayer-iOS](https://github.com/svga/SVGAPlayer-iOS) å¼€å‘ï¼Œæ„Ÿè°¢åŸä½œè€…çš„è´¡çŒ®ã€‚

---

**SVGAPlayer-Lite** - æ›´å¿«ã€æ›´è½»ã€æ›´ç°ä»£çš„ SVGA åŠ¨ç”»æ’­æ”¾å™¨ ğŸš€
